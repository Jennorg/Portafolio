---
import type { Technology } from '@portafolio/shared-types';
import Container from '../ui/container.astro';

const backendUrl = import.meta.env.BACKEND_URL;

let technologies: Technology[] = [];
let error: string | null = null;

try {
  console.log("Fetching technologies from:", backendUrl); // Debug log

  if (!backendUrl) {
    throw new Error("BACKEND_URL no está definida en las variables de entorno");
  }

  const response = await fetch(`${backendUrl}/api/technologies`);
  
  if (!response.ok) {
    throw new Error(`Error del servidor: ${response.status} ${response.statusText}`);
  }
  
  technologies = (await response.json()) as Technology[];

} catch (e) {
  error = e instanceof Error ? e.message : "Error desconocido";
  console.error("Error fetching technologies from", backendUrl, ":", e);
}
---

<section class="max-w-4xl mx-auto h-screen flex flex-col justify-center">
  <h2 class="text-3xl font-bold text-center mb-8">Tecnologías</h2>
  
  {error && (
    <div class="test-error text-red-500 p-4 border border-red-500 rounded my-4">
      <p>Lo sentimos, no pudimos cargar las tecnologías.</p>
      <span>{error}</span>
    </div>
  )}

  {technologies.length === 0 && !error && <p class="text-center">No hay tecnologías para mostrar.</p>}

  <div class="flex flex-wrap justify-center gap-6">
    {technologies.map((technology) => (
      <Container>
        <div class="w-12 h-12 flex items-center justify-center p-2 bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm hover:scale-110 transition-transform text-gray-600 dark:text-gray-200" title={technology.name}>
             <div class="w-full h-full [&>svg]:w-full [&>svg]:h-full [&>svg]:fill-current" set:html={technology.icon} />
        </div>
        <p class="text-xs text-center mt-2 font-medium">{technology.name}</p>
      </Container>
    ))}
  </div>
</section>