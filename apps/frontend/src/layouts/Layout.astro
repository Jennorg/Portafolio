---
import Header from '../components/sections/Header.astro';
import '../styles/global.css';
import '@fontsource/outfit';
import { ClientRouter } from 'astro:transitions';

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <ClientRouter />
    <!-- Validar el tema inicial en el localStorage para evitar flashees al cargar el default -->

    <script is:inline>
      const getThemePreference = () => {
        if (
          typeof localStorage !== 'undefined' &&
          localStorage.getItem('theme')
        ) {
          return localStorage.getItem('theme');
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'dark'
          : 'light';
      };

      const isDark = getThemePreference() === 'dark';

      document.documentElement.classList[isDark ? 'add' : 'remove']('dark');

     document.addEventListener('astro:after-swap', () => {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      });
 
      document.addEventListener('DOMContentLoaded', () => {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px"
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('reveal-visible');
              entry.target.classList.remove('reveal-hidden');
              observer.unobserve(entry.target); 
            }
          });
        }, observerOptions);

        const elements = document.querySelectorAll('section');
        elements.forEach(el => {
          el.classList.add('reveal-hidden');
          observer.observe(el);
        });
      });
    </script>

    <title>{title}</title>
  </head>
  <body class="w-full h-full bg-main text-[var(--color-text-body)] relative">
    
    <!-- Animated Background -->
    <div class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-secondary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-accent/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
    </div>

    <Header />
    <main class="px-4 sm:px-10 max-w-7xl mx-auto">
      <slot />
    </main>
  </body>
</html>
